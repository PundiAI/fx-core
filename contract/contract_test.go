package contract_test

import (
	"bytes"
	"encoding/base64"
	"encoding/hex"
	"math/big"
	"testing"

	"github.com/ethereum/go-ethereum/common"
	"github.com/stretchr/testify/require"

	"github.com/pundiai/fx-core/v8/contract"
)

func TestPackBridgeCallback(t *testing.T) {
	type arg struct {
		sender   common.Address
		receiver common.Address
		_tokens  []common.Address
		_amounts []*big.Int
		data     []byte
		memo     []byte
	}
	tests := []struct {
		name     string
		args     arg
		expected string
		err      error
	}{
		{
			name: "ok",
			args: arg{
				sender:   common.HexToAddress("0x0000000000000000000000000000000000000001"),
				receiver: common.HexToAddress("0x0000000000000000000000000000000000000002"),
				_tokens: []common.Address{
					common.HexToAddress("0x0000000000000000000000000000000000000001"),
					common.HexToAddress("0x0000000000000000000000000000000000000002"),
					common.HexToAddress("0x0000000000000000000000000000000000000003"),
				},
				_amounts: []*big.Int{
					big.NewInt(1),
					big.NewInt(2),
					big.NewInt(3),
				},
				// transferFrom(address,address,uint256) 0x0000000000000000000000000000000000000001 0x0000000000000000000000000000000000000002 1000000000000000000
				data: common.Hex2Bytes("23b872dd000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000de0b6b3a7640000"),
				// memo string
				memo: common.Hex2Bytes("6d656d6f00000000000000000000000000000000000000000000000000000000"),
			},
			expected: "57ffc0920000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000000000000000000000000000000000000000000026000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006423b872dd000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000de0b6b3a76400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000206d656d6f00000000000000000000000000000000000000000000000000000000",
			err:      nil,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			result, err := contract.PackOnBridgeCall(tt.args.sender, tt.args.receiver, tt.args._tokens, tt.args._amounts, tt.args.data, tt.args.memo)
			if tt.err != nil {
				require.Error(t, err)
				require.EqualValues(t, tt.err.Error(), err.Error())
				return
			}

			require.NoError(t, err)
			require.EqualValues(t, tt.expected, hex.EncodeToString(result))
		})
	}
}

func TestERC20Code(t *testing.T) {
	codeAddr := "0x79172102144e0ef3dc372c3774f3225fbba20066"
	codeBase64 := "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"

	code, codeNew := replayCodeAddress(codeBase64, codeAddr, contract.ERC20LogicAddress)
	require.Equal(t, "60806040526004361061011f5760003560e01c8063715018a6116100a0578063b86d529811610064578063b86d52981461031c578063c5cb9b511461033a578063dd62ed3e1461035a578063de7ea79d146103a0578063f2fde38b146103c057600080fd5b8063715018a6146102805780638da5cb5b1461029557806395d89b41146102c75780639dc29fac146102dc578063a9059cbb146102fc57600080fd5b80633659cfe6116100e75780633659cfe6146101e057806340c10f19146102025780634f1ef2861461022257806352d1902d1461023557806370a082311461024a57600080fd5b806306fdde0314610124578063095ea7b31461014f57806318160ddd1461017f57806323b872dd1461019e578063313ce567146101be575b600080fd5b34801561013057600080fd5b506101396103e0565b6040516101469190611afa565b60405180910390f35b34801561015b57600080fd5b5061016f61016a36600461189a565b610472565b6040519015158152602001610146565b34801561018b57600080fd5b5060cc545b604051908152602001610146565b3480156101aa57600080fd5b5061016f6101b9366004611800565b6104c8565b3480156101ca57600080fd5b5060cb5460405160ff9091168152602001610146565b3480156101ec57600080fd5b506102006101fb3660046117b4565b610577565b005b34801561020e57600080fd5b5061020061021d36600461189a565b610657565b61020061023036600461183b565b61068f565b34801561024157600080fd5b5061019061075c565b34801561025657600080fd5b506101906102653660046117b4565b6001600160a01b0316600090815260cd602052604090205490565b34801561028c57600080fd5b5061020061080f565b3480156102a157600080fd5b506097546001600160a01b03165b6040516001600160a01b039091168152602001610146565b3480156102d357600080fd5b50610139610845565b3480156102e857600080fd5b506102006102f736600461189a565b610854565b34801561030857600080fd5b5061016f61031736600461189a565b610888565b34801561032857600080fd5b5060cf546001600160a01b03166102af565b34801561034657600080fd5b5061016f6103553660046119ce565b61089e565b34801561036657600080fd5b506101906103753660046117ce565b6001600160a01b03918216600090815260ce6020908152604080832093909416825291909152205490565b3480156103ac57600080fd5b506102006103bb366004611945565b610954565b3480156103cc57600080fd5b506102006103db3660046117b4565b610a73565b606060c980546103ef90611d08565b80601f016020809104026020016040519081016040528092919081815260200182805461041b90611d08565b80156104685780601f1061043d57610100808354040283529160200191610468565b820191906000526020600020905b81548152906001019060200180831161044b57829003601f168201915b5050505050905090565b600061047f338484610b0b565b6040518281526001600160a01b0384169033907f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259060200160405180910390a350600192915050565b6001600160a01b038316600090815260ce602090815260408083203384529091528120548281101561054b5760405162461bcd60e51b815260206004820152602160248201527f7472616e7366657220616d6f756e74206578636565647320616c6c6f77616e636044820152606560f81b60648201526084015b60405180910390fd5b61055f853361055a8685611cc5565b610b0b565b61056a858585610b8d565b60019150505b9392505050565b306001600160a01b037f00000000000000000000000000000000000000000000000000000000000000001614156105c05760405162461bcd60e51b815260040161054290611b3c565b7f00000000000000000000000000000000000000000000000000000000000000006001600160a01b0316610609600080516020611d70833981519152546001600160a01b031690565b6001600160a01b03161461062f5760405162461bcd60e51b815260040161054290611b88565b61063881610d3c565b6040805160008082526020820190925261065491839190610d66565b50565b6097546001600160a01b031633146106815760405162461bcd60e51b815260040161054290611bd4565b61068b8282610ee5565b5050565b306001600160a01b037f00000000000000000000000000000000000000000000000000000000000000001614156106d85760405162461bcd60e51b815260040161054290611b3c565b7f00000000000000000000000000000000000000000000000000000000000000006001600160a01b0316610721600080516020611d70833981519152546001600160a01b031690565b6001600160a01b0316146107475760405162461bcd60e51b815260040161054290611b88565b61075082610d3c565b61068b82826001610d66565b6000306001600160a01b037f000000000000000000000000000000000000000000000000000000000000000016146107fc5760405162461bcd60e51b815260206004820152603860248201527f555550535570677261646561626c653a206d757374206e6f742062652063616c60448201527f6c6564207468726f7567682064656c656761746563616c6c00000000000000006064820152608401610542565b50600080516020611d7083398151915290565b6097546001600160a01b031633146108395760405162461bcd60e51b815260040161054290611bd4565b6108436000610fc4565b565b606060ca80546103ef90611d08565b6097546001600160a01b0316331461087e5760405162461bcd60e51b815260040161054290611bd4565b61068b8282611016565b6000610895338484610b8d565b50600192915050565b600063ffffffff333b16156108f55760405162461bcd60e51b815260206004820152601960248201527f63616c6c65722063616e6e6f7420626520636f6e7472616374000000000000006044820152606401610542565b6109023386868686611158565b336001600160a01b03167f282dd1817b996776123a00596764d4d54cc16460c9854f7a23f6be020ba0463d868686866040516109419493929190611b0d565b60405180910390a2506001949350505050565b600054610100900460ff1661096f5760005460ff1615610973565b303b155b6109d65760405162461bcd60e51b815260206004820152602e60248201527f496e697469616c697a61626c653a20636f6e747261637420697320616c72656160448201526d191e481a5b9a5d1a585b1a5e995960921b6064820152608401610542565b600054610100900460ff161580156109f8576000805461ffff19166101011790555b8451610a0b9060c99060208801906116a2565b508351610a1f9060ca9060208701906116a2565b5060cb805460ff191660ff851617905560cf80546001600160a01b0319166001600160a01b038416179055610a5261131b565b610a5a61134a565b8015610a6c576000805461ff00191690555b5050505050565b6097546001600160a01b03163314610a9d5760405162461bcd60e51b815260040161054290611bd4565b6001600160a01b038116610b025760405162461bcd60e51b815260206004820152602660248201527f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160448201526564647265737360d01b6064820152608401610542565b61065481610fc4565b6001600160a01b038316610b615760405162461bcd60e51b815260206004820152601d60248201527f617070726f76652066726f6d20746865207a65726f20616464726573730000006044820152606401610542565b6001600160a01b03928316600090815260ce602090815260408083209490951682529290925291902055565b6001600160a01b038316610be35760405162461bcd60e51b815260206004820152601e60248201527f7472616e736665722066726f6d20746865207a65726f206164647265737300006044820152606401610542565b6001600160a01b038216610c395760405162461bcd60e51b815260206004820152601c60248201527f7472616e7366657220746f20746865207a65726f2061646472657373000000006044820152606401610542565b6001600160a01b038316600090815260cd602052604090205481811015610ca25760405162461bcd60e51b815260206004820152601f60248201527f7472616e7366657220616d6f756e7420657863656564732062616c616e6365006044820152606401610542565b610cac8282611cc5565b6001600160a01b03808616600090815260cd60205260408082209390935590851681529081208054849290610ce2908490611cad565b92505081905550826001600160a01b0316846001600160a01b03167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef84604051610d2e91815260200190565b60405180910390a350505050565b6097546001600160a01b031633146106545760405162461bcd60e51b815260040161054290611bd4565b7f4910fdfa16fed3260ed0e7147f7cc6da11a60208b5b9406d12a635614ffd91435460ff1615610d9e57610d9983611371565b505050565b826001600160a01b03166352d1902d6040518163ffffffff1660e01b815260040160206040518083038186803b158015610dd757600080fd5b505afa925050508015610e07575060408051601f3d908101601f19168201909252610e04918101906118c3565b60015b610e6a5760405162461bcd60e51b815260206004820152602e60248201527f45524331393637557067726164653a206e657720696d706c656d656e7461746960448201526d6f6e206973206e6f74205555505360901b6064820152608401610542565b600080516020611d708339815191528114610ed95760405162461bcd60e51b815260206004820152602960248201527f45524331393637557067726164653a20756e737570706f727465642070726f786044820152681a58589b195555525160ba1b6064820152608401610542565b50610d9983838361140d565b6001600160a01b038216610f3b5760405162461bcd60e51b815260206004820152601860248201527f6d696e7420746f20746865207a65726f206164647265737300000000000000006044820152606401610542565b8060cc6000828254610f4d9190611cad565b90915550506001600160a01b038216600090815260cd602052604081208054839290610f7a908490611cad565b90915550506040518181526001600160a01b038316906000907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9060200160405180910390a35050565b609780546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a35050565b6001600160a01b03821661106c5760405162461bcd60e51b815260206004820152601a60248201527f6275726e2066726f6d20746865207a65726f20616464726573730000000000006044820152606401610542565b6001600160a01b038216600090815260cd6020526040902054818110156110d55760405162461bcd60e51b815260206004820152601b60248201527f6275726e20616d6f756e7420657863656564732062616c616e636500000000006044820152606401610542565b6110df8282611cc5565b6001600160a01b038416600090815260cd602052604081209190915560cc805484929061110d908490611cc5565b90915550506040518281526000906001600160a01b038516907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9060200160405180910390a3505050565b6001600160a01b0385166111ae5760405162461bcd60e51b815260206004820152601e60248201527f7472616e736665722066726f6d20746865207a65726f206164647265737300006044820152606401610542565b60008451116111f35760405162461bcd60e51b81526020600482015260116024820152701a5b9d985b1a59081c9958da5c1a595b9d607a1b6044820152606401610542565b806112315760405162461bcd60e51b815260206004820152600e60248201526d1a5b9d985b1a59081d185c99d95d60921b6044820152606401610542565b60cf546112529086906001600160a01b031661124d8587611cad565b610b8d565b6000806110046001600160a01b031661127e888888888860405180602001604052806000815250611438565b60405161128b9190611a4c565b6000604051808303816000865af19150503d80600081146112c8576040519150601f19603f3d011682016040523d82523d6000602084013e6112cd565b606091505b509150915061131282826040518060400160405280601b81526020017f7472616e736665722063726f737320636861696e206661696c6564000000000081525061148b565b50505050505050565b600054610100900460ff166113425760405162461bcd60e51b815260040161054290611c09565b610843611505565b600054610100900460ff166108435760405162461bcd60e51b815260040161054290611c09565b6001600160a01b0381163b6113de5760405162461bcd60e51b815260206004820152602d60248201527f455243313936373a206e657720696d706c656d656e746174696f6e206973206e60448201526c1bdd08184818dbdb9d1c9858dd609a1b6064820152608401610542565b600080516020611d7083398151915280546001600160a01b0319166001600160a01b0392909216919091179055565b61141683611535565b6000825111806114235750805b15610d99576114328383611575565b50505050565b606086868686868660405160240161145596959493929190611aa5565b60408051601f198184030181529190526020810180516001600160e01b0316633c3e7d7760e01b17905290509695505050505050565b82610d99576000828060200190518101906114a691906118db565b90506001825110156114cc578060405162461bcd60e51b81526004016105429190611afa565b81816040516020016114df929190611a68565b60408051601f198184030181529082905262461bcd60e51b825261054291600401611afa565b600054610100900460ff1661152c5760405162461bcd60e51b815260040161054290611c09565b61084333610fc4565b61153e81611371565b6040516001600160a01b038216907fbc7cd75a20ee27fd9adebab32041f755214dbc6bffa90cc0225b39da2e5c2d3b90600090a250565b60606001600160a01b0383163b6115dd5760405162461bcd60e51b815260206004820152602660248201527f416464726573733a2064656c65676174652063616c6c20746f206e6f6e2d636f6044820152651b9d1c9858dd60d21b6064820152608401610542565b600080846001600160a01b0316846040516115f89190611a4c565b600060405180830381855af49150503d8060008114611633576040519150601f19603f3d011682016040523d82523d6000602084013e611638565b606091505b50915091506116608282604051806060016040528060278152602001611d9060279139611669565b95945050505050565b60608315611678575081610570565b8251156116885782518084602001fd5b8160405162461bcd60e51b81526004016105429190611afa565b8280546116ae90611d08565b90600052602060002090601f0160209004810192826116d05760008555611716565b82601f106116e957805160ff1916838001178555611716565b82800160010185558215611716579182015b828111156117165782518255916020019190600101906116fb565b50611722929150611726565b5090565b5b808211156117225760008155600101611727565b600061174e61174984611c85565b611c54565b905082815283838301111561176257600080fd5b828260208301376000602084830101529392505050565b80356001600160a01b038116811461179057600080fd5b919050565b600082601f8301126117a5578081fd5b6105708383356020850161173b565b6000602082840312156117c5578081fd5b61057082611779565b600080604083850312156117e0578081fd5b6117e983611779565b91506117f760208401611779565b90509250929050565b600080600060608486031215611814578081fd5b61181d84611779565b925061182b60208501611779565b9150604084013590509250925092565b6000806040838503121561184d578182fd5b61185683611779565b9150602083013567ffffffffffffffff811115611871578182fd5b8301601f81018513611881578182fd5b6118908582356020840161173b565b9150509250929050565b600080604083850312156118ac578182fd5b6118b583611779565b946020939093013593505050565b6000602082840312156118d4578081fd5b5051919050565b6000602082840312156118ec578081fd5b815167ffffffffffffffff811115611902578182fd5b8201601f81018413611912578182fd5b805161192061174982611c85565b818152856020838501011115611934578384fd5b611660826020830160208601611cdc565b6000806000806080858703121561195a578081fd5b843567ffffffffffffffff80821115611971578283fd5b61197d88838901611795565b95506020870135915080821115611992578283fd5b5061199f87828801611795565b935050604085013560ff811681146119b5578182fd5b91506119c360608601611779565b905092959194509250565b600080600080608085870312156119e3578384fd5b843567ffffffffffffffff8111156119f9578485fd5b611a0587828801611795565b97602087013597506040870135966060013595509350505050565b60008151808452611a38816020860160208601611cdc565b601f01601f19169290920160200192915050565b60008251611a5e818460208701611cdc565b9190910192915050565b60008351611a7a818460208801611cdc565b6101d160f51b9083019081528351611a99816002840160208801611cdc565b01600201949350505050565b6001600160a01b038716815260c060208201819052600090611ac990830188611a20565b86604084015285606084015284608084015282810360a0840152611aed8185611a20565b9998505050505050505050565b6020815260006105706020830184611a20565b608081526000611b206080830187611a20565b6020830195909552506040810192909252606090910152919050565b6020808252602c908201527f46756e6374696f6e206d7573742062652063616c6c6564207468726f7567682060408201526b19195b1959d85d1958d85b1b60a21b606082015260800190565b6020808252602c908201527f46756e6374696f6e206d7573742062652063616c6c6564207468726f7567682060408201526b6163746976652070726f787960a01b606082015260800190565b6020808252818101527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572604082015260600190565b6020808252602b908201527f496e697469616c697a61626c653a20636f6e7472616374206973206e6f74206960408201526a6e697469616c697a696e6760a81b606082015260800190565b604051601f8201601f1916810167ffffffffffffffff81118282101715611c7d57611c7d611d59565b604052919050565b600067ffffffffffffffff821115611c9f57611c9f611d59565b50601f01601f191660200190565b60008219821115611cc057611cc0611d43565b500190565b600082821015611cd757611cd7611d43565b500390565b60005b83811015611cf7578181015183820152602001611cdf565b838111156114325750506000910152565b600181811c90821680611d1c57607f821691505b60208210811415611d3d57634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052601160045260246000fd5b634e487b7160e01b600052604160045260246000fdfe360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc416464726573733a206c6f772d6c6576656c2064656c65676174652063616c6c206661696c6564a26469706673582212203b820696364250693508f4a7a5e7e57685a305efda3e6577e74dfee930ff276e64736f6c63430008040033", hex.EncodeToString(code))
	require.Equal(t, "60806040526004361061011f5760003560e01c8063715018a6116100a0578063b86d529811610064578063b86d52981461031c578063c5cb9b511461033a578063dd62ed3e1461035a578063de7ea79d146103a0578063f2fde38b146103c057600080fd5b8063715018a6146102805780638da5cb5b1461029557806395d89b41146102c75780639dc29fac146102dc578063a9059cbb146102fc57600080fd5b80633659cfe6116100e75780633659cfe6146101e057806340c10f19146102025780634f1ef2861461022257806352d1902d1461023557806370a082311461024a57600080fd5b806306fdde0314610124578063095ea7b31461014f57806318160ddd1461017f57806323b872dd1461019e578063313ce567146101be575b600080fd5b34801561013057600080fd5b506101396103e0565b6040516101469190611afa565b60405180910390f35b34801561015b57600080fd5b5061016f61016a36600461189a565b610472565b6040519015158152602001610146565b34801561018b57600080fd5b5060cc545b604051908152602001610146565b3480156101aa57600080fd5b5061016f6101b9366004611800565b6104c8565b3480156101ca57600080fd5b5060cb5460405160ff9091168152602001610146565b3480156101ec57600080fd5b506102006101fb3660046117b4565b610577565b005b34801561020e57600080fd5b5061020061021d36600461189a565b610657565b61020061023036600461183b565b61068f565b34801561024157600080fd5b5061019061075c565b34801561025657600080fd5b506101906102653660046117b4565b6001600160a01b0316600090815260cd602052604090205490565b34801561028c57600080fd5b5061020061080f565b3480156102a157600080fd5b506097546001600160a01b03165b6040516001600160a01b039091168152602001610146565b3480156102d357600080fd5b50610139610845565b3480156102e857600080fd5b506102006102f736600461189a565b610854565b34801561030857600080fd5b5061016f61031736600461189a565b610888565b34801561032857600080fd5b5060cf546001600160a01b03166102af565b34801561034657600080fd5b5061016f6103553660046119ce565b61089e565b34801561036657600080fd5b506101906103753660046117ce565b6001600160a01b03918216600090815260ce6020908152604080832093909416825291909152205490565b3480156103ac57600080fd5b506102006103bb366004611945565b610954565b3480156103cc57600080fd5b506102006103db3660046117b4565b610a73565b606060c980546103ef90611d08565b80601f016020809104026020016040519081016040528092919081815260200182805461041b90611d08565b80156104685780601f1061043d57610100808354040283529160200191610468565b820191906000526020600020905b81548152906001019060200180831161044b57829003601f168201915b5050505050905090565b600061047f338484610b0b565b6040518281526001600160a01b0384169033907f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259060200160405180910390a350600192915050565b6001600160a01b038316600090815260ce602090815260408083203384529091528120548281101561054b5760405162461bcd60e51b815260206004820152602160248201527f7472616e7366657220616d6f756e74206578636565647320616c6c6f77616e636044820152606560f81b60648201526084015b60405180910390fd5b61055f853361055a8685611cc5565b610b0b565b61056a858585610b8d565b60019150505b9392505050565b306001600160a01b037f00000000000000000000000000000000000000000000000000000000000010011614156105c05760405162461bcd60e51b815260040161054290611b3c565b7f00000000000000000000000000000000000000000000000000000000000010016001600160a01b0316610609600080516020611d70833981519152546001600160a01b031690565b6001600160a01b03161461062f5760405162461bcd60e51b815260040161054290611b88565b61063881610d3c565b6040805160008082526020820190925261065491839190610d66565b50565b6097546001600160a01b031633146106815760405162461bcd60e51b815260040161054290611bd4565b61068b8282610ee5565b5050565b306001600160a01b037f00000000000000000000000000000000000000000000000000000000000010011614156106d85760405162461bcd60e51b815260040161054290611b3c565b7f00000000000000000000000000000000000000000000000000000000000010016001600160a01b0316610721600080516020611d70833981519152546001600160a01b031690565b6001600160a01b0316146107475760405162461bcd60e51b815260040161054290611b88565b61075082610d3c565b61068b82826001610d66565b6000306001600160a01b037f000000000000000000000000000000000000000000000000000000000000100116146107fc5760405162461bcd60e51b815260206004820152603860248201527f555550535570677261646561626c653a206d757374206e6f742062652063616c60448201527f6c6564207468726f7567682064656c656761746563616c6c00000000000000006064820152608401610542565b50600080516020611d7083398151915290565b6097546001600160a01b031633146108395760405162461bcd60e51b815260040161054290611bd4565b6108436000610fc4565b565b606060ca80546103ef90611d08565b6097546001600160a01b0316331461087e5760405162461bcd60e51b815260040161054290611bd4565b61068b8282611016565b6000610895338484610b8d565b50600192915050565b600063ffffffff333b16156108f55760405162461bcd60e51b815260206004820152601960248201527f63616c6c65722063616e6e6f7420626520636f6e7472616374000000000000006044820152606401610542565b6109023386868686611158565b336001600160a01b03167f282dd1817b996776123a00596764d4d54cc16460c9854f7a23f6be020ba0463d868686866040516109419493929190611b0d565b60405180910390a2506001949350505050565b600054610100900460ff1661096f5760005460ff1615610973565b303b155b6109d65760405162461bcd60e51b815260206004820152602e60248201527f496e697469616c697a61626c653a20636f6e747261637420697320616c72656160448201526d191e481a5b9a5d1a585b1a5e995960921b6064820152608401610542565b600054610100900460ff161580156109f8576000805461ffff19166101011790555b8451610a0b9060c99060208801906116a2565b508351610a1f9060ca9060208701906116a2565b5060cb805460ff191660ff851617905560cf80546001600160a01b0319166001600160a01b038416179055610a5261131b565b610a5a61134a565b8015610a6c576000805461ff00191690555b5050505050565b6097546001600160a01b03163314610a9d5760405162461bcd60e51b815260040161054290611bd4565b6001600160a01b038116610b025760405162461bcd60e51b815260206004820152602660248201527f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160448201526564647265737360d01b6064820152608401610542565b61065481610fc4565b6001600160a01b038316610b615760405162461bcd60e51b815260206004820152601d60248201527f617070726f76652066726f6d20746865207a65726f20616464726573730000006044820152606401610542565b6001600160a01b03928316600090815260ce602090815260408083209490951682529290925291902055565b6001600160a01b038316610be35760405162461bcd60e51b815260206004820152601e60248201527f7472616e736665722066726f6d20746865207a65726f206164647265737300006044820152606401610542565b6001600160a01b038216610c395760405162461bcd60e51b815260206004820152601c60248201527f7472616e7366657220746f20746865207a65726f2061646472657373000000006044820152606401610542565b6001600160a01b038316600090815260cd602052604090205481811015610ca25760405162461bcd60e51b815260206004820152601f60248201527f7472616e7366657220616d6f756e7420657863656564732062616c616e6365006044820152606401610542565b610cac8282611cc5565b6001600160a01b03808616600090815260cd60205260408082209390935590851681529081208054849290610ce2908490611cad565b92505081905550826001600160a01b0316846001600160a01b03167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef84604051610d2e91815260200190565b60405180910390a350505050565b6097546001600160a01b031633146106545760405162461bcd60e51b815260040161054290611bd4565b7f4910fdfa16fed3260ed0e7147f7cc6da11a60208b5b9406d12a635614ffd91435460ff1615610d9e57610d9983611371565b505050565b826001600160a01b03166352d1902d6040518163ffffffff1660e01b815260040160206040518083038186803b158015610dd757600080fd5b505afa925050508015610e07575060408051601f3d908101601f19168201909252610e04918101906118c3565b60015b610e6a5760405162461bcd60e51b815260206004820152602e60248201527f45524331393637557067726164653a206e657720696d706c656d656e7461746960448201526d6f6e206973206e6f74205555505360901b6064820152608401610542565b600080516020611d708339815191528114610ed95760405162461bcd60e51b815260206004820152602960248201527f45524331393637557067726164653a20756e737570706f727465642070726f786044820152681a58589b195555525160ba1b6064820152608401610542565b50610d9983838361140d565b6001600160a01b038216610f3b5760405162461bcd60e51b815260206004820152601860248201527f6d696e7420746f20746865207a65726f206164647265737300000000000000006044820152606401610542565b8060cc6000828254610f4d9190611cad565b90915550506001600160a01b038216600090815260cd602052604081208054839290610f7a908490611cad565b90915550506040518181526001600160a01b038316906000907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9060200160405180910390a35050565b609780546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a35050565b6001600160a01b03821661106c5760405162461bcd60e51b815260206004820152601a60248201527f6275726e2066726f6d20746865207a65726f20616464726573730000000000006044820152606401610542565b6001600160a01b038216600090815260cd6020526040902054818110156110d55760405162461bcd60e51b815260206004820152601b60248201527f6275726e20616d6f756e7420657863656564732062616c616e636500000000006044820152606401610542565b6110df8282611cc5565b6001600160a01b038416600090815260cd602052604081209190915560cc805484929061110d908490611cc5565b90915550506040518281526000906001600160a01b038516907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9060200160405180910390a3505050565b6001600160a01b0385166111ae5760405162461bcd60e51b815260206004820152601e60248201527f7472616e736665722066726f6d20746865207a65726f206164647265737300006044820152606401610542565b60008451116111f35760405162461bcd60e51b81526020600482015260116024820152701a5b9d985b1a59081c9958da5c1a595b9d607a1b6044820152606401610542565b806112315760405162461bcd60e51b815260206004820152600e60248201526d1a5b9d985b1a59081d185c99d95d60921b6044820152606401610542565b60cf546112529086906001600160a01b031661124d8587611cad565b610b8d565b6000806110046001600160a01b031661127e888888888860405180602001604052806000815250611438565b60405161128b9190611a4c565b6000604051808303816000865af19150503d80600081146112c8576040519150601f19603f3d011682016040523d82523d6000602084013e6112cd565b606091505b509150915061131282826040518060400160405280601b81526020017f7472616e736665722063726f737320636861696e206661696c6564000000000081525061148b565b50505050505050565b600054610100900460ff166113425760405162461bcd60e51b815260040161054290611c09565b610843611505565b600054610100900460ff166108435760405162461bcd60e51b815260040161054290611c09565b6001600160a01b0381163b6113de5760405162461bcd60e51b815260206004820152602d60248201527f455243313936373a206e657720696d706c656d656e746174696f6e206973206e60448201526c1bdd08184818dbdb9d1c9858dd609a1b6064820152608401610542565b600080516020611d7083398151915280546001600160a01b0319166001600160a01b0392909216919091179055565b61141683611535565b6000825111806114235750805b15610d99576114328383611575565b50505050565b606086868686868660405160240161145596959493929190611aa5565b60408051601f198184030181529190526020810180516001600160e01b0316633c3e7d7760e01b17905290509695505050505050565b82610d99576000828060200190518101906114a691906118db565b90506001825110156114cc578060405162461bcd60e51b81526004016105429190611afa565b81816040516020016114df929190611a68565b60408051601f198184030181529082905262461bcd60e51b825261054291600401611afa565b600054610100900460ff1661152c5760405162461bcd60e51b815260040161054290611c09565b61084333610fc4565b61153e81611371565b6040516001600160a01b038216907fbc7cd75a20ee27fd9adebab32041f755214dbc6bffa90cc0225b39da2e5c2d3b90600090a250565b60606001600160a01b0383163b6115dd5760405162461bcd60e51b815260206004820152602660248201527f416464726573733a2064656c65676174652063616c6c20746f206e6f6e2d636f6044820152651b9d1c9858dd60d21b6064820152608401610542565b600080846001600160a01b0316846040516115f89190611a4c565b600060405180830381855af49150503d8060008114611633576040519150601f19603f3d011682016040523d82523d6000602084013e611638565b606091505b50915091506116608282604051806060016040528060278152602001611d9060279139611669565b95945050505050565b60608315611678575081610570565b8251156116885782518084602001fd5b8160405162461bcd60e51b81526004016105429190611afa565b8280546116ae90611d08565b90600052602060002090601f0160209004810192826116d05760008555611716565b82601f106116e957805160ff1916838001178555611716565b82800160010185558215611716579182015b828111156117165782518255916020019190600101906116fb565b50611722929150611726565b5090565b5b808211156117225760008155600101611727565b600061174e61174984611c85565b611c54565b905082815283838301111561176257600080fd5b828260208301376000602084830101529392505050565b80356001600160a01b038116811461179057600080fd5b919050565b600082601f8301126117a5578081fd5b6105708383356020850161173b565b6000602082840312156117c5578081fd5b61057082611779565b600080604083850312156117e0578081fd5b6117e983611779565b91506117f760208401611779565b90509250929050565b600080600060608486031215611814578081fd5b61181d84611779565b925061182b60208501611779565b9150604084013590509250925092565b6000806040838503121561184d578182fd5b61185683611779565b9150602083013567ffffffffffffffff811115611871578182fd5b8301601f81018513611881578182fd5b6118908582356020840161173b565b9150509250929050565b600080604083850312156118ac578182fd5b6118b583611779565b946020939093013593505050565b6000602082840312156118d4578081fd5b5051919050565b6000602082840312156118ec578081fd5b815167ffffffffffffffff811115611902578182fd5b8201601f81018413611912578182fd5b805161192061174982611c85565b818152856020838501011115611934578384fd5b611660826020830160208601611cdc565b6000806000806080858703121561195a578081fd5b843567ffffffffffffffff80821115611971578283fd5b61197d88838901611795565b95506020870135915080821115611992578283fd5b5061199f87828801611795565b935050604085013560ff811681146119b5578182fd5b91506119c360608601611779565b905092959194509250565b600080600080608085870312156119e3578384fd5b843567ffffffffffffffff8111156119f9578485fd5b611a0587828801611795565b97602087013597506040870135966060013595509350505050565b60008151808452611a38816020860160208601611cdc565b601f01601f19169290920160200192915050565b60008251611a5e818460208701611cdc565b9190910192915050565b60008351611a7a818460208801611cdc565b6101d160f51b9083019081528351611a99816002840160208801611cdc565b01600201949350505050565b6001600160a01b038716815260c060208201819052600090611ac990830188611a20565b86604084015285606084015284608084015282810360a0840152611aed8185611a20565b9998505050505050505050565b6020815260006105706020830184611a20565b608081526000611b206080830187611a20565b6020830195909552506040810192909252606090910152919050565b6020808252602c908201527f46756e6374696f6e206d7573742062652063616c6c6564207468726f7567682060408201526b19195b1959d85d1958d85b1b60a21b606082015260800190565b6020808252602c908201527f46756e6374696f6e206d7573742062652063616c6c6564207468726f7567682060408201526b6163746976652070726f787960a01b606082015260800190565b6020808252818101527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572604082015260600190565b6020808252602b908201527f496e697469616c697a61626c653a20636f6e7472616374206973206e6f74206960408201526a6e697469616c697a696e6760a81b606082015260800190565b604051601f8201601f1916810167ffffffffffffffff81118282101715611c7d57611c7d611d59565b604052919050565b600067ffffffffffffffff821115611c9f57611c9f611d59565b50601f01601f191660200190565b60008219821115611cc057611cc0611d43565b500190565b600082821015611cd757611cd7611d43565b500390565b60005b83811015611cf7578181015183820152602001611cdf565b838111156114325750506000910152565b600181811c90821680611d1c57607f821691505b60208210811415611d3d57634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052601160045260246000fd5b634e487b7160e01b600052604160045260246000fdfe360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc416464726573733a206c6f772d6c6576656c2064656c65676174652063616c6c206661696c6564a26469706673582212203b820696364250693508f4a7a5e7e57685a305efda3e6577e74dfee930ff276e64736f6c63430008040033", hex.EncodeToString(codeNew))
	require.NotEqual(t, hex.EncodeToString(code), hex.EncodeToString(codeNew))
}

func TestWarpTokenCode(t *testing.T) {
	codeAddr := "0x0f40EeCB63928367dcbf5Db326fD5A2824c76926"
	codeBase64 := "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"

	code, codeNew := replayCodeAddress(codeBase64, codeAddr, contract.WPUNDIAILogicAddress)
	require.Equal(t, "6080604052600436106101395760003560e01c80638da5cb5b116100ab578063c5cb9b511161006f578063c5cb9b5114610364578063d0e30db014610148578063dd62ed3e14610377578063de7ea79d146103bd578063f2fde38b146103dd578063f3fef3a3146103fd57610148565b80638da5cb5b146102bf57806395d89b41146102f15780639dc29fac14610306578063a9059cbb14610326578063b86d52981461034657610148565b80633659cfe6116100fd5780633659cfe61461020c57806340c10f191461022c5780634f1ef2861461024c57806352d1902d1461025f57806370a0823114610274578063715018a6146102aa57610148565b806306fdde0314610150578063095ea7b31461017b57806318160ddd146101ab57806323b872dd146101ca578063313ce567146101ea57610148565b366101485761014661041d565b005b61014661041d565b34801561015c57600080fd5b5061016561045e565b6040516101729190611c0e565b60405180910390f35b34801561018757600080fd5b5061019b6101963660046119c3565b6104f0565b6040519015158152602001610172565b3480156101b757600080fd5b5060cc545b604051908152602001610172565b3480156101d657600080fd5b5061019b6101e5366004611922565b610546565b3480156101f657600080fd5b5060cb5460405160ff9091168152602001610172565b34801561021857600080fd5b506101466102273660046118a3565b6105f5565b34801561023857600080fd5b506101466102473660046119c3565b6106d5565b61014661025a366004611962565b61070d565b34801561026b57600080fd5b506101bc6107da565b34801561028057600080fd5b506101bc61028f3660046118a3565b6001600160a01b0316600090815260cd602052604090205490565b3480156102b657600080fd5b5061014661088d565b3480156102cb57600080fd5b506097546001600160a01b03165b6040516001600160a01b039091168152602001610172565b3480156102fd57600080fd5b506101656108c3565b34801561031257600080fd5b506101466103213660046119c3565b6108d2565b34801561033257600080fd5b5061019b6103413660046119c3565b610906565b34801561035257600080fd5b5060cf546001600160a01b03166102d9565b61019b610372366004611ae2565b61091c565b34801561038357600080fd5b506101bc6103923660046118ea565b6001600160a01b03918216600090815260ce6020908152604080832093909416825291909152205490565b3480156103c957600080fd5b506101466103d8366004611a57565b6109e0565b3480156103e957600080fd5b506101466103f83660046118a3565b610aff565b34801561040957600080fd5b506101466104183660046118bf565b610b97565b6104273334610c1d565b60405134815233907fe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c9060200160405180910390a2565b606060c9805461046d90611e1c565b80601f016020809104026020016040519081016040528092919081815260200182805461049990611e1c565b80156104e65780601f106104bb576101008083540402835291602001916104e6565b820191906000526020600020905b8154815290600101906020018083116104c957829003601f168201915b5050505050905090565b60006104fd338484610cf5565b6040518281526001600160a01b0384169033907f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259060200160405180910390a350600192915050565b6001600160a01b038316600090815260ce60209081526040808320338452909152812054828110156105c95760405162461bcd60e51b815260206004820152602160248201527f7472616e7366657220616d6f756e74206578636565647320616c6c6f77616e636044820152606560f81b60648201526084015b60405180910390fd5b6105dd85336105d88685611dd9565b610cf5565b6105e8858585610d77565b60019150505b9392505050565b306001600160a01b037f000000000000000000000000000000000000000000000000000000000000000016141561063e5760405162461bcd60e51b81526004016105c090611c50565b7f00000000000000000000000000000000000000000000000000000000000000006001600160a01b0316610687600080516020611e99833981519152546001600160a01b031690565b6001600160a01b0316146106ad5760405162461bcd60e51b81526004016105c090611c9c565b6106b681610f26565b604080516000808252602082019092526106d291839190610f50565b50565b6097546001600160a01b031633146106ff5760405162461bcd60e51b81526004016105c090611ce8565b6107098282610c1d565b5050565b306001600160a01b037f00000000000000000000000000000000000000000000000000000000000000001614156107565760405162461bcd60e51b81526004016105c090611c50565b7f00000000000000000000000000000000000000000000000000000000000000006001600160a01b031661079f600080516020611e99833981519152546001600160a01b031690565b6001600160a01b0316146107c55760405162461bcd60e51b81526004016105c090611c9c565b6107ce82610f26565b61070982826001610f50565b6000306001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000161461087a5760405162461bcd60e51b815260206004820152603860248201527f555550535570677261646561626c653a206d757374206e6f742062652063616c60448201527f6c6564207468726f7567682064656c656761746563616c6c000000000000000060648201526084016105c0565b50600080516020611e9983398151915290565b6097546001600160a01b031633146108b75760405162461bcd60e51b81526004016105c090611ce8565b6108c160006110cf565b565b606060ca805461046d90611e1c565b6097546001600160a01b031633146108fc5760405162461bcd60e51b81526004016105c090611ce8565b6107098282611121565b6000610913338484610d77565b50600192915050565b600063ffffffff333b16156109735760405162461bcd60e51b815260206004820152601960248201527f63616c6c65722063616e6e6f7420626520636f6e74726163740000000000000060448201526064016105c0565b34156109815761098161041d565b61098e3386868686611263565b336001600160a01b03167f282dd1817b996776123a00596764d4d54cc16460c9854f7a23f6be020ba0463d868686866040516109cd9493929190611c21565b60405180910390a2506001949350505050565b600054610100900460ff166109fb5760005460ff16156109ff565b303b155b610a625760405162461bcd60e51b815260206004820152602e60248201527f496e697469616c697a61626c653a20636f6e747261637420697320616c72656160448201526d191e481a5b9a5d1a585b1a5e995960921b60648201526084016105c0565b600054610100900460ff16158015610a84576000805461ffff19166101011790555b8451610a979060c99060208801906117ad565b508351610aab9060ca9060208701906117ad565b5060cb805460ff191660ff851617905560cf80546001600160a01b0319166001600160a01b038416179055610ade611426565b610ae6611455565b8015610af8576000805461ff00191690555b5050505050565b6097546001600160a01b03163314610b295760405162461bcd60e51b81526004016105c090611ce8565b6001600160a01b038116610b8e5760405162461bcd60e51b815260206004820152602660248201527f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160448201526564647265737360d01b60648201526084016105c0565b6106d2816110cf565b610ba13382611121565b6040516001600160a01b0383169082156108fc029083906000818181858888f19350505050158015610bd7573d6000803e3d6000fd5b506040518181526001600160a01b0383169033907f9b1bfa7fa9ee420a16e124f794c35ac9f90472acc99140eb2f6447c714cad8eb906020015b60405180910390a35050565b6001600160a01b038216610c735760405162461bcd60e51b815260206004820152601860248201527f6d696e7420746f20746865207a65726f2061646472657373000000000000000060448201526064016105c0565b8060cc6000828254610c859190611dc1565b90915550506001600160a01b038216600090815260cd602052604081208054839290610cb2908490611dc1565b90915550506040518181526001600160a01b038316906000907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef90602001610c11565b6001600160a01b038316610d4b5760405162461bcd60e51b815260206004820152601d60248201527f617070726f76652066726f6d20746865207a65726f206164647265737300000060448201526064016105c0565b6001600160a01b03928316600090815260ce602090815260408083209490951682529290925291902055565b6001600160a01b038316610dcd5760405162461bcd60e51b815260206004820152601e60248201527f7472616e736665722066726f6d20746865207a65726f2061646472657373000060448201526064016105c0565b6001600160a01b038216610e235760405162461bcd60e51b815260206004820152601c60248201527f7472616e7366657220746f20746865207a65726f20616464726573730000000060448201526064016105c0565b6001600160a01b038316600090815260cd602052604090205481811015610e8c5760405162461bcd60e51b815260206004820152601f60248201527f7472616e7366657220616d6f756e7420657863656564732062616c616e63650060448201526064016105c0565b610e968282611dd9565b6001600160a01b03808616600090815260cd60205260408082209390935590851681529081208054849290610ecc908490611dc1565b92505081905550826001600160a01b0316846001600160a01b03167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef84604051610f1891815260200190565b60405180910390a350505050565b6097546001600160a01b031633146106d25760405162461bcd60e51b81526004016105c090611ce8565b7f4910fdfa16fed3260ed0e7147f7cc6da11a60208b5b9406d12a635614ffd91435460ff1615610f8857610f838361147c565b505050565b826001600160a01b03166352d1902d6040518163ffffffff1660e01b815260040160206040518083038186803b158015610fc157600080fd5b505afa925050508015610ff1575060408051601f3d908101601f19168201909252610fee918101906119d5565b60015b6110545760405162461bcd60e51b815260206004820152602e60248201527f45524331393637557067726164653a206e657720696d706c656d656e7461746960448201526d6f6e206973206e6f74205555505360901b60648201526084016105c0565b600080516020611e9983398151915281146110c35760405162461bcd60e51b815260206004820152602960248201527f45524331393637557067726164653a20756e737570706f727465642070726f786044820152681a58589b195555525160ba1b60648201526084016105c0565b50610f83838383611518565b609780546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a35050565b6001600160a01b0382166111775760405162461bcd60e51b815260206004820152601a60248201527f6275726e2066726f6d20746865207a65726f206164647265737300000000000060448201526064016105c0565b6001600160a01b038216600090815260cd6020526040902054818110156111e05760405162461bcd60e51b815260206004820152601b60248201527f6275726e20616d6f756e7420657863656564732062616c616e6365000000000060448201526064016105c0565b6111ea8282611dd9565b6001600160a01b038416600090815260cd602052604081209190915560cc8054849290611218908490611dd9565b90915550506040518281526000906001600160a01b038516907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9060200160405180910390a3505050565b6001600160a01b0385166112b95760405162461bcd60e51b815260206004820152601e60248201527f7472616e736665722066726f6d20746865207a65726f2061646472657373000060448201526064016105c0565b60008451116112fe5760405162461bcd60e51b81526020600482015260116024820152701a5b9d985b1a59081c9958da5c1a595b9d607a1b60448201526064016105c0565b8061133c5760405162461bcd60e51b815260206004820152600e60248201526d1a5b9d985b1a59081d185c99d95d60921b60448201526064016105c0565b60cf5461135d9086906001600160a01b03166113588587611dc1565b610d77565b6000806110046001600160a01b0316611389888888888860405180602001604052806000815250611543565b6040516113969190611b60565b6000604051808303816000865af19150503d80600081146113d3576040519150601f19603f3d011682016040523d82523d6000602084013e6113d8565b606091505b509150915061141d82826040518060400160405280601b81526020017f7472616e736665722063726f737320636861696e206661696c65640000000000815250611596565b50505050505050565b600054610100900460ff1661144d5760405162461bcd60e51b81526004016105c090611d1d565b6108c1611610565b600054610100900460ff166108c15760405162461bcd60e51b81526004016105c090611d1d565b6001600160a01b0381163b6114e95760405162461bcd60e51b815260206004820152602d60248201527f455243313936373a206e657720696d706c656d656e746174696f6e206973206e60448201526c1bdd08184818dbdb9d1c9858dd609a1b60648201526084016105c0565b600080516020611e9983398151915280546001600160a01b0319166001600160a01b0392909216919091179055565b61152183611640565b60008251118061152e5750805b15610f835761153d8383611680565b50505050565b606086868686868660405160240161156096959493929190611bb9565b60408051601f198184030181529190526020810180516001600160e01b0316633c3e7d7760e01b17905290509695505050505050565b82610f83576000828060200190518101906115b191906119ed565b90506001825110156115d7578060405162461bcd60e51b81526004016105c09190611c0e565b81816040516020016115ea929190611b7c565b60408051601f198184030181529082905262461bcd60e51b82526105c091600401611c0e565b600054610100900460ff166116375760405162461bcd60e51b81526004016105c090611d1d565b6108c1336110cf565b6116498161147c565b6040516001600160a01b038216907fbc7cd75a20ee27fd9adebab32041f755214dbc6bffa90cc0225b39da2e5c2d3b90600090a250565b60606001600160a01b0383163b6116e85760405162461bcd60e51b815260206004820152602660248201527f416464726573733a2064656c65676174652063616c6c20746f206e6f6e2d636f6044820152651b9d1c9858dd60d21b60648201526084016105c0565b600080846001600160a01b0316846040516117039190611b60565b600060405180830381855af49150503d806000811461173e576040519150601f19603f3d011682016040523d82523d6000602084013e611743565b606091505b509150915061176b8282604051806060016040528060278152602001611eb960279139611774565b95945050505050565b606083156117835750816105ee565b8251156117935782518084602001fd5b8160405162461bcd60e51b81526004016105c09190611c0e565b8280546117b990611e1c565b90600052602060002090601f0160209004810192826117db5760008555611821565b82601f106117f457805160ff1916838001178555611821565b82800160010185558215611821579182015b82811115611821578251825591602001919060010190611806565b5061182d929150611831565b5090565b5b8082111561182d5760008155600101611832565b600061185961185484611d99565b611d68565b905082815283838301111561186d57600080fd5b828260208301376000602084830101529392505050565b600082601f830112611894578081fd5b6105ee83833560208501611846565b6000602082840312156118b4578081fd5b81356105ee81611e83565b600080604083850312156118d1578081fd5b82356118dc81611e83565b946020939093013593505050565b600080604083850312156118fc578182fd5b823561190781611e83565b9150602083013561191781611e83565b809150509250929050565b600080600060608486031215611936578081fd5b833561194181611e83565b9250602084013561195181611e83565b929592945050506040919091013590565b60008060408385031215611974578182fd5b823561197f81611e83565b9150602083013567ffffffffffffffff81111561199a578182fd5b8301601f810185136119aa578182fd5b6119b985823560208401611846565b9150509250929050565b600080604083850312156118d1578182fd5b6000602082840312156119e6578081fd5b5051919050565b6000602082840312156119fe578081fd5b815167ffffffffffffffff811115611a14578182fd5b8201601f81018413611a24578182fd5b8051611a3261185482611d99565b818152856020838501011115611a46578384fd5b61176b826020830160208601611df0565b60008060008060808587031215611a6c578081fd5b843567ffffffffffffffff80821115611a83578283fd5b611a8f88838901611884565b95506020870135915080821115611aa4578283fd5b50611ab187828801611884565b935050604085013560ff81168114611ac7578182fd5b91506060850135611ad781611e83565b939692955090935050565b60008060008060808587031215611af7578384fd5b843567ffffffffffffffff811115611b0d578485fd5b611b1987828801611884565b97602087013597506040870135966060013595509350505050565b60008151808452611b4c816020860160208601611df0565b601f01601f19169290920160200192915050565b60008251611b72818460208701611df0565b9190910192915050565b60008351611b8e818460208801611df0565b6101d160f51b9083019081528351611bad816002840160208801611df0565b01600201949350505050565b6001600160a01b038716815260c060208201819052600090611bdd90830188611b34565b86604084015285606084015284608084015282810360a0840152611c018185611b34565b9998505050505050505050565b6020815260006105ee6020830184611b34565b608081526000611c346080830187611b34565b6020830195909552506040810192909252606090910152919050565b6020808252602c908201527f46756e6374696f6e206d7573742062652063616c6c6564207468726f7567682060408201526b19195b1959d85d1958d85b1b60a21b606082015260800190565b6020808252602c908201527f46756e6374696f6e206d7573742062652063616c6c6564207468726f7567682060408201526b6163746976652070726f787960a01b606082015260800190565b6020808252818101527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572604082015260600190565b6020808252602b908201527f496e697469616c697a61626c653a20636f6e7472616374206973206e6f74206960408201526a6e697469616c697a696e6760a81b606082015260800190565b604051601f8201601f1916810167ffffffffffffffff81118282101715611d9157611d91611e6d565b604052919050565b600067ffffffffffffffff821115611db357611db3611e6d565b50601f01601f191660200190565b60008219821115611dd457611dd4611e57565b500190565b600082821015611deb57611deb611e57565b500390565b60005b83811015611e0b578181015183820152602001611df3565b8381111561153d5750506000910152565b600181811c90821680611e3057607f821691505b60208210811415611e5157634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052601160045260246000fd5b634e487b7160e01b600052604160045260246000fd5b6001600160a01b03811681146106d257600080fdfe360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc416464726573733a206c6f772d6c6576656c2064656c65676174652063616c6c206661696c6564a2646970667358221220c3b1cd913030a18195eba376a78d2ea5e6cb2500466d9f96635c54aa3829033164736f6c63430008040033", hex.EncodeToString(code))
	require.Equal(t, "6080604052600436106101395760003560e01c80638da5cb5b116100ab578063c5cb9b511161006f578063c5cb9b5114610364578063d0e30db014610148578063dd62ed3e14610377578063de7ea79d146103bd578063f2fde38b146103dd578063f3fef3a3146103fd57610148565b80638da5cb5b146102bf57806395d89b41146102f15780639dc29fac14610306578063a9059cbb14610326578063b86d52981461034657610148565b80633659cfe6116100fd5780633659cfe61461020c57806340c10f191461022c5780634f1ef2861461024c57806352d1902d1461025f57806370a0823114610274578063715018a6146102aa57610148565b806306fdde0314610150578063095ea7b31461017b57806318160ddd146101ab57806323b872dd146101ca578063313ce567146101ea57610148565b366101485761014661041d565b005b61014661041d565b34801561015c57600080fd5b5061016561045e565b6040516101729190611c0e565b60405180910390f35b34801561018757600080fd5b5061019b6101963660046119c3565b6104f0565b6040519015158152602001610172565b3480156101b757600080fd5b5060cc545b604051908152602001610172565b3480156101d657600080fd5b5061019b6101e5366004611922565b610546565b3480156101f657600080fd5b5060cb5460405160ff9091168152602001610172565b34801561021857600080fd5b506101466102273660046118a3565b6105f5565b34801561023857600080fd5b506101466102473660046119c3565b6106d5565b61014661025a366004611962565b61070d565b34801561026b57600080fd5b506101bc6107da565b34801561028057600080fd5b506101bc61028f3660046118a3565b6001600160a01b0316600090815260cd602052604090205490565b3480156102b657600080fd5b5061014661088d565b3480156102cb57600080fd5b506097546001600160a01b03165b6040516001600160a01b039091168152602001610172565b3480156102fd57600080fd5b506101656108c3565b34801561031257600080fd5b506101466103213660046119c3565b6108d2565b34801561033257600080fd5b5061019b6103413660046119c3565b610906565b34801561035257600080fd5b5060cf546001600160a01b03166102d9565b61019b610372366004611ae2565b61091c565b34801561038357600080fd5b506101bc6103923660046118ea565b6001600160a01b03918216600090815260ce6020908152604080832093909416825291909152205490565b3480156103c957600080fd5b506101466103d8366004611a57565b6109e0565b3480156103e957600080fd5b506101466103f83660046118a3565b610aff565b34801561040957600080fd5b506101466104183660046118bf565b610b97565b6104273334610c1d565b60405134815233907fe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c9060200160405180910390a2565b606060c9805461046d90611e1c565b80601f016020809104026020016040519081016040528092919081815260200182805461049990611e1c565b80156104e65780601f106104bb576101008083540402835291602001916104e6565b820191906000526020600020905b8154815290600101906020018083116104c957829003601f168201915b5050505050905090565b60006104fd338484610cf5565b6040518281526001600160a01b0384169033907f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259060200160405180910390a350600192915050565b6001600160a01b038316600090815260ce60209081526040808320338452909152812054828110156105c95760405162461bcd60e51b815260206004820152602160248201527f7472616e7366657220616d6f756e74206578636565647320616c6c6f77616e636044820152606560f81b60648201526084015b60405180910390fd5b6105dd85336105d88685611dd9565b610cf5565b6105e8858585610d77565b60019150505b9392505050565b306001600160a01b037f000000000000000000000000000000000000000000000000000000000000100216141561063e5760405162461bcd60e51b81526004016105c090611c50565b7f00000000000000000000000000000000000000000000000000000000000010026001600160a01b0316610687600080516020611e99833981519152546001600160a01b031690565b6001600160a01b0316146106ad5760405162461bcd60e51b81526004016105c090611c9c565b6106b681610f26565b604080516000808252602082019092526106d291839190610f50565b50565b6097546001600160a01b031633146106ff5760405162461bcd60e51b81526004016105c090611ce8565b6107098282610c1d565b5050565b306001600160a01b037f00000000000000000000000000000000000000000000000000000000000010021614156107565760405162461bcd60e51b81526004016105c090611c50565b7f00000000000000000000000000000000000000000000000000000000000010026001600160a01b031661079f600080516020611e99833981519152546001600160a01b031690565b6001600160a01b0316146107c55760405162461bcd60e51b81526004016105c090611c9c565b6107ce82610f26565b61070982826001610f50565b6000306001600160a01b037f0000000000000000000000000000000000000000000000000000000000001002161461087a5760405162461bcd60e51b815260206004820152603860248201527f555550535570677261646561626c653a206d757374206e6f742062652063616c60448201527f6c6564207468726f7567682064656c656761746563616c6c000000000000000060648201526084016105c0565b50600080516020611e9983398151915290565b6097546001600160a01b031633146108b75760405162461bcd60e51b81526004016105c090611ce8565b6108c160006110cf565b565b606060ca805461046d90611e1c565b6097546001600160a01b031633146108fc5760405162461bcd60e51b81526004016105c090611ce8565b6107098282611121565b6000610913338484610d77565b50600192915050565b600063ffffffff333b16156109735760405162461bcd60e51b815260206004820152601960248201527f63616c6c65722063616e6e6f7420626520636f6e74726163740000000000000060448201526064016105c0565b34156109815761098161041d565b61098e3386868686611263565b336001600160a01b03167f282dd1817b996776123a00596764d4d54cc16460c9854f7a23f6be020ba0463d868686866040516109cd9493929190611c21565b60405180910390a2506001949350505050565b600054610100900460ff166109fb5760005460ff16156109ff565b303b155b610a625760405162461bcd60e51b815260206004820152602e60248201527f496e697469616c697a61626c653a20636f6e747261637420697320616c72656160448201526d191e481a5b9a5d1a585b1a5e995960921b60648201526084016105c0565b600054610100900460ff16158015610a84576000805461ffff19166101011790555b8451610a979060c99060208801906117ad565b508351610aab9060ca9060208701906117ad565b5060cb805460ff191660ff851617905560cf80546001600160a01b0319166001600160a01b038416179055610ade611426565b610ae6611455565b8015610af8576000805461ff00191690555b5050505050565b6097546001600160a01b03163314610b295760405162461bcd60e51b81526004016105c090611ce8565b6001600160a01b038116610b8e5760405162461bcd60e51b815260206004820152602660248201527f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160448201526564647265737360d01b60648201526084016105c0565b6106d2816110cf565b610ba13382611121565b6040516001600160a01b0383169082156108fc029083906000818181858888f19350505050158015610bd7573d6000803e3d6000fd5b506040518181526001600160a01b0383169033907f9b1bfa7fa9ee420a16e124f794c35ac9f90472acc99140eb2f6447c714cad8eb906020015b60405180910390a35050565b6001600160a01b038216610c735760405162461bcd60e51b815260206004820152601860248201527f6d696e7420746f20746865207a65726f2061646472657373000000000000000060448201526064016105c0565b8060cc6000828254610c859190611dc1565b90915550506001600160a01b038216600090815260cd602052604081208054839290610cb2908490611dc1565b90915550506040518181526001600160a01b038316906000907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef90602001610c11565b6001600160a01b038316610d4b5760405162461bcd60e51b815260206004820152601d60248201527f617070726f76652066726f6d20746865207a65726f206164647265737300000060448201526064016105c0565b6001600160a01b03928316600090815260ce602090815260408083209490951682529290925291902055565b6001600160a01b038316610dcd5760405162461bcd60e51b815260206004820152601e60248201527f7472616e736665722066726f6d20746865207a65726f2061646472657373000060448201526064016105c0565b6001600160a01b038216610e235760405162461bcd60e51b815260206004820152601c60248201527f7472616e7366657220746f20746865207a65726f20616464726573730000000060448201526064016105c0565b6001600160a01b038316600090815260cd602052604090205481811015610e8c5760405162461bcd60e51b815260206004820152601f60248201527f7472616e7366657220616d6f756e7420657863656564732062616c616e63650060448201526064016105c0565b610e968282611dd9565b6001600160a01b03808616600090815260cd60205260408082209390935590851681529081208054849290610ecc908490611dc1565b92505081905550826001600160a01b0316846001600160a01b03167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef84604051610f1891815260200190565b60405180910390a350505050565b6097546001600160a01b031633146106d25760405162461bcd60e51b81526004016105c090611ce8565b7f4910fdfa16fed3260ed0e7147f7cc6da11a60208b5b9406d12a635614ffd91435460ff1615610f8857610f838361147c565b505050565b826001600160a01b03166352d1902d6040518163ffffffff1660e01b815260040160206040518083038186803b158015610fc157600080fd5b505afa925050508015610ff1575060408051601f3d908101601f19168201909252610fee918101906119d5565b60015b6110545760405162461bcd60e51b815260206004820152602e60248201527f45524331393637557067726164653a206e657720696d706c656d656e7461746960448201526d6f6e206973206e6f74205555505360901b60648201526084016105c0565b600080516020611e9983398151915281146110c35760405162461bcd60e51b815260206004820152602960248201527f45524331393637557067726164653a20756e737570706f727465642070726f786044820152681a58589b195555525160ba1b60648201526084016105c0565b50610f83838383611518565b609780546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a35050565b6001600160a01b0382166111775760405162461bcd60e51b815260206004820152601a60248201527f6275726e2066726f6d20746865207a65726f206164647265737300000000000060448201526064016105c0565b6001600160a01b038216600090815260cd6020526040902054818110156111e05760405162461bcd60e51b815260206004820152601b60248201527f6275726e20616d6f756e7420657863656564732062616c616e6365000000000060448201526064016105c0565b6111ea8282611dd9565b6001600160a01b038416600090815260cd602052604081209190915560cc8054849290611218908490611dd9565b90915550506040518281526000906001600160a01b038516907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9060200160405180910390a3505050565b6001600160a01b0385166112b95760405162461bcd60e51b815260206004820152601e60248201527f7472616e736665722066726f6d20746865207a65726f2061646472657373000060448201526064016105c0565b60008451116112fe5760405162461bcd60e51b81526020600482015260116024820152701a5b9d985b1a59081c9958da5c1a595b9d607a1b60448201526064016105c0565b8061133c5760405162461bcd60e51b815260206004820152600e60248201526d1a5b9d985b1a59081d185c99d95d60921b60448201526064016105c0565b60cf5461135d9086906001600160a01b03166113588587611dc1565b610d77565b6000806110046001600160a01b0316611389888888888860405180602001604052806000815250611543565b6040516113969190611b60565b6000604051808303816000865af19150503d80600081146113d3576040519150601f19603f3d011682016040523d82523d6000602084013e6113d8565b606091505b509150915061141d82826040518060400160405280601b81526020017f7472616e736665722063726f737320636861696e206661696c65640000000000815250611596565b50505050505050565b600054610100900460ff1661144d5760405162461bcd60e51b81526004016105c090611d1d565b6108c1611610565b600054610100900460ff166108c15760405162461bcd60e51b81526004016105c090611d1d565b6001600160a01b0381163b6114e95760405162461bcd60e51b815260206004820152602d60248201527f455243313936373a206e657720696d706c656d656e746174696f6e206973206e60448201526c1bdd08184818dbdb9d1c9858dd609a1b60648201526084016105c0565b600080516020611e9983398151915280546001600160a01b0319166001600160a01b0392909216919091179055565b61152183611640565b60008251118061152e5750805b15610f835761153d8383611680565b50505050565b606086868686868660405160240161156096959493929190611bb9565b60408051601f198184030181529190526020810180516001600160e01b0316633c3e7d7760e01b17905290509695505050505050565b82610f83576000828060200190518101906115b191906119ed565b90506001825110156115d7578060405162461bcd60e51b81526004016105c09190611c0e565b81816040516020016115ea929190611b7c565b60408051601f198184030181529082905262461bcd60e51b82526105c091600401611c0e565b600054610100900460ff166116375760405162461bcd60e51b81526004016105c090611d1d565b6108c1336110cf565b6116498161147c565b6040516001600160a01b038216907fbc7cd75a20ee27fd9adebab32041f755214dbc6bffa90cc0225b39da2e5c2d3b90600090a250565b60606001600160a01b0383163b6116e85760405162461bcd60e51b815260206004820152602660248201527f416464726573733a2064656c65676174652063616c6c20746f206e6f6e2d636f6044820152651b9d1c9858dd60d21b60648201526084016105c0565b600080846001600160a01b0316846040516117039190611b60565b600060405180830381855af49150503d806000811461173e576040519150601f19603f3d011682016040523d82523d6000602084013e611743565b606091505b509150915061176b8282604051806060016040528060278152602001611eb960279139611774565b95945050505050565b606083156117835750816105ee565b8251156117935782518084602001fd5b8160405162461bcd60e51b81526004016105c09190611c0e565b8280546117b990611e1c565b90600052602060002090601f0160209004810192826117db5760008555611821565b82601f106117f457805160ff1916838001178555611821565b82800160010185558215611821579182015b82811115611821578251825591602001919060010190611806565b5061182d929150611831565b5090565b5b8082111561182d5760008155600101611832565b600061185961185484611d99565b611d68565b905082815283838301111561186d57600080fd5b828260208301376000602084830101529392505050565b600082601f830112611894578081fd5b6105ee83833560208501611846565b6000602082840312156118b4578081fd5b81356105ee81611e83565b600080604083850312156118d1578081fd5b82356118dc81611e83565b946020939093013593505050565b600080604083850312156118fc578182fd5b823561190781611e83565b9150602083013561191781611e83565b809150509250929050565b600080600060608486031215611936578081fd5b833561194181611e83565b9250602084013561195181611e83565b929592945050506040919091013590565b60008060408385031215611974578182fd5b823561197f81611e83565b9150602083013567ffffffffffffffff81111561199a578182fd5b8301601f810185136119aa578182fd5b6119b985823560208401611846565b9150509250929050565b600080604083850312156118d1578182fd5b6000602082840312156119e6578081fd5b5051919050565b6000602082840312156119fe578081fd5b815167ffffffffffffffff811115611a14578182fd5b8201601f81018413611a24578182fd5b8051611a3261185482611d99565b818152856020838501011115611a46578384fd5b61176b826020830160208601611df0565b60008060008060808587031215611a6c578081fd5b843567ffffffffffffffff80821115611a83578283fd5b611a8f88838901611884565b95506020870135915080821115611aa4578283fd5b50611ab187828801611884565b935050604085013560ff81168114611ac7578182fd5b91506060850135611ad781611e83565b939692955090935050565b60008060008060808587031215611af7578384fd5b843567ffffffffffffffff811115611b0d578485fd5b611b1987828801611884565b97602087013597506040870135966060013595509350505050565b60008151808452611b4c816020860160208601611df0565b601f01601f19169290920160200192915050565b60008251611b72818460208701611df0565b9190910192915050565b60008351611b8e818460208801611df0565b6101d160f51b9083019081528351611bad816002840160208801611df0565b01600201949350505050565b6001600160a01b038716815260c060208201819052600090611bdd90830188611b34565b86604084015285606084015284608084015282810360a0840152611c018185611b34565b9998505050505050505050565b6020815260006105ee6020830184611b34565b608081526000611c346080830187611b34565b6020830195909552506040810192909252606090910152919050565b6020808252602c908201527f46756e6374696f6e206d7573742062652063616c6c6564207468726f7567682060408201526b19195b1959d85d1958d85b1b60a21b606082015260800190565b6020808252602c908201527f46756e6374696f6e206d7573742062652063616c6c6564207468726f7567682060408201526b6163746976652070726f787960a01b606082015260800190565b6020808252818101527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572604082015260600190565b6020808252602b908201527f496e697469616c697a61626c653a20636f6e7472616374206973206e6f74206960408201526a6e697469616c697a696e6760a81b606082015260800190565b604051601f8201601f1916810167ffffffffffffffff81118282101715611d9157611d91611e6d565b604052919050565b600067ffffffffffffffff821115611db357611db3611e6d565b50601f01601f191660200190565b60008219821115611dd457611dd4611e57565b500190565b600082821015611deb57611deb611e57565b500390565b60005b83811015611e0b578181015183820152602001611df3565b8381111561153d5750506000910152565b600181811c90821680611e3057607f821691505b60208210811415611e5157634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052601160045260246000fd5b634e487b7160e01b600052604160045260246000fd5b6001600160a01b03811681146106d257600080fdfe360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc416464726573733a206c6f772d6c6576656c2064656c65676174652063616c6c206661696c6564a2646970667358221220c3b1cd913030a18195eba376a78d2ea5e6cb2500466d9f96635c54aa3829033164736f6c63430008040033", hex.EncodeToString(codeNew))
	require.NotEqual(t, hex.EncodeToString(code), hex.EncodeToString(codeNew))
}

func replayCodeAddress(codeBase64, addr, addrNew string) (code, codeNew []byte) {
	bz, err := base64.StdEncoding.DecodeString(codeBase64)
	if err != nil {
		panic(err)
	}

	addr1 := common.HexToAddress(addr)
	addr2 := common.HexToAddress(addrNew)

	bzZero := bytes.ReplaceAll(bz, addr1.Bytes(), common.Address{}.Bytes())
	bzNew := bytes.ReplaceAll(bz, addr1.Bytes(), addr2.Bytes())

	return bzZero, bzNew
}

func TestUnpackRevertError(t *testing.T) {
	bridgeFeeQuoteABI := contract.GetBridgeFeeQuote().ABI

	errSigs := make([]string, 0, len(bridgeFeeQuoteABI.Errors))
	for _, e := range bridgeFeeQuoteABI.Errors {
		errSig := hex.EncodeToString(e.ID[:4])
		require.NotContains(t, errSigs, errSig)
		errSigs = append(errSigs, errSig)
	}
}
